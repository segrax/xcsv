<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <title>xCsv</title>
		
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
		
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha256-ZT4HPpdCOt2lvDkXokHuhJfdOKSPFLzeAJik5U/Q+l4=" crossorigin="anonymous" />
		
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js" integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.8.9/jquery.csv.min.js" integrity="sha256-F8eQhL9KDGgaDitxiSyq6SnTCL0m67rt7niivBtH2rc=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js" integrity="sha256-CutOzxCRucUsn6C6TcEYsauvvYilEniTXldPa6/wu0k=" crossorigin="anonymous"></script>
        
        <script src="xcsv.js"></script>
	</head>	
	
	<body id="id_body">

        <div>
            <input type="file" id="files" name="files[]" multiple />
            <div id="id_detected" class="well"></div>
            <button type="button" id="id_btn_convert">Convert</button>

            <div id="id_loadedfile" class="well"></div>

            <script>
                $('#id_btn_convert').on("click", function() {
                    $('#id_loadedfile').text($('body').xcsv("convert", $('#id_loadedfile').text(), $('#id_detected').text()));
                });

                $('body').xcsv();
                
                    function handleFile(pFile) {
                        pFile.name;

                        var reader = new FileReader();

                        reader.onload = (function(theFile) {
                            return function(e) {

                                $('#id_loadedfile').text(e.target.result);
                                var exchange = $('body').xcsv("detect", $('#id_loadedfile').text());
                                $('#id_detected').text(exchange);
                                
                            };
                        })(pFile);

                        reader.readAsText(pFile);
                    }
                    
                    function handleFileSelect(evt) {
                        var files = evt.target.files;
                    
                        for (var i = 0, file; file = files[i]; i++) {

                            handleFile(file);
                            break;
                        }

                        $('#id_loadedfile').html();
                    }
                    
                    document.getElementById('files').addEventListener('change', handleFileSelect, false);
                </script>
        </div>

	</body>
</html>